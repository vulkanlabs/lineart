
FROM {{ base_image }}


# Copy files from official SDK image, including script/dependencies.
COPY --from=apache/beam_python{{ python_version }}_sdk:{{ beam_sdk_version }} /opt/apache/beam /opt/apache/beam


# TODO: This is a workaround to ensure vulkan dependencies are installed,
# including the Apache Beam SDK.
RUN uv pip install --system --no-cache --extra beam -r /opt/dependencies/vulkan/pyproject.toml


# Copy Flex Template launcher binary from the launcher image, which makes it
# possible to use the image as a Flex Template base image.
COPY --from={{ flex_template_base_image }} /opt/google/dataflow/python_template_launcher /opt/google/dataflow/python_template_launcher
COPY launch_dataflow.py /template/launch_dataflow.py
ENV FLEX_TEMPLATE_PYTHON_PY_FILE="/template/launch_dataflow.py"


# Set the entrypoint to Apache Beam SDK launcher.
ENTRYPOINT ["/opt/apache/beam/boot"]
